---
title: "Objects Launched into Space"
subtitle: "INFO 526 - Summer 2024 - Final Project"
author: 
  - name: "Derek Rice"
    affiliations:
      - name: "School of Information, University of Arizona"
description: "Project description"
format:
   html:
    code-tools: true
    code-overflow: wrap
    embed-resources: true
editor: visual
execute:
  warning: false
  echo: false
---

## Introduction

The intent of this project was to understand the evolution of countries engaged in rocket and space technologies and predict countries who will dominate space in the near future. To complete the analysis the dataset "yearly number of objects launched into outer space" was leveraged. The dataset provides the number of objects launched into space from 1957 to 2022 as a function of country. The source of the dataset is the United Nations Office of Outer Space Affairs and the dataset is available within the tidytuesday package.

The analysis was completed in two stages. First, the 1957 to 2022 data was analyzed and plotted as a smooth line plot by country and on a world map, see Figures 1 and 2 respectively. These two plots document the early years of the rocket technology and highlight the dominance of Russia during the infancy of rocket technology, see Figure 2. The static smooth line plots and the interactive maps used to tell the space faring story were created using ggplot2 and the Plotly package respectively.

The 1957 to 2022 data was employed to identify the fifteen prominent space faring nations, the countries with the largest number of objects launched. For each of these fifteen countries a second order polynomial regression model was calculated. The country model was utilized to create a second dataset and predict launches between 2001 and 2022 and extrapolate the number of objects launched up to the year 2100. The results of the model and predicted number of launches are displayed on a static ggplot smooth line plot and an interactive world map, see Figures 3 and 4.

The analysis indicates that Russia, once a dominant force in space technologies will fail to keep pace with other nations eventually losing its ability to launch space objects. The work suggests that the United States will dominate space and that China will replace Russia as an important contributor to the industry. Surprisingly the analysis indicates India will rise at the third most active nation with respect to launching objects into space.

## Datasets

### (I) The Space Objects Dataset (1957 to 2023)

-   The dataset summarizes the number of objects launched into space from 1957 to 2023 as a function of entity.
-   The source of the dataset is the United Nations Office of Outer Space Affairs. A prior analysis of the dataset is available here: https://ourworldindata.org/grapher/yearly-number-of-objects-launched-into-outer-space
-   Dataset source: https://github.com/rfordatascience/tidytuesday/blob/master/data/2024/2024-04-23/readme.md
-   The dataset is comprised of 4 columns and 1175 rows - see "head" and "glimpse" summarized herein.
-   I choose the dataset because I was thinking it would be interesting to identify the countries launching gadgets into space and the magnitude of the difference between the United States and other countries.
-   Figure 1: A static graphical plot summary of the data - the plot presents an overview of the dataset and visually displays the number of launches per entity between 1957 and 2023.
-   Figure 2: A dynamic world map - move the slider located on the bottom of the map graphic from 1957 to 2023 to see highlighted countries launching space vehicles each year.

### (II) Space Objects Predicted (2001 to 2100)

-   The origian dataset was used to identify the fifteen most active countries launching gadgets into space.
-   A second order polynomial Y (number of objects) = function (interectp + year + year\^2) for the fifteen most active countries was calculated.
-   The model was used to predict the number of launches between 2001 and 2023 and extrapolate the number of launches up to year 2100.
-   The data generated by the model was stored in a dataset called "extrapolated_data"
-   It was this extrapolated dataset that I was most interested in to understand tends in the industry
-   The "extrapolated_data" included five columns (i) Year, (ii) predicted_launches, (iii) Entity, (iv) Code, and (v) hover
-   Entity was the country launching gadgets into space - nomenclature carry over from original dataset
-   Code was the country code needed for identifying the "entity" on the map
-   hover was the information displayed when the mouse is hovering over a country on the interactive map
-   Figure 3: A static graphical smooth line plot of the predicted and extrapolated data from 2001 to 2100.
-   Figure 4: A dynamic map, zoom in and move around the map, there is a slider located at the base of the map, move the slider to display predicted launch events from 2001 to 2100.

### Data Variable Descriptions: (I) The Space Objects Dataset (1957 to 2023)

The dataset comprises 4 columns and 1175 rows. The dataset summarizes space launch events between 1957 and 2023 as a function of the entity or country responsible for the launch.

Entity: <character> the country launching the space object

Code: <character> the type of gadget launched into Earth orbit or beyond (satellites, probes, landers, crewed spacecrafts, and space station components)

Year: <double-precision floating-point number> the year of the launch

num_objects: <double-precision floating-point number> the number of objects launched by "Entity" during a year.

### Data Variable Descriptions: (II) The Space Objects Predicted (2001 to 2100)

The extrapolated_data dataset comprises 5 columns. The dataset summarizes predicted space launch events from 2001 to 2100 using the second order polynomial regression model generated from the original "space objects dataset".

Year: <double-precision floating-point number> the year of the launch

predicted_launches: <double-precision floating-point number> the number of objects launched by "Entity" during a year.

Entity: <character> the country launching the space object

Code: <character> the type of gadget launched into Earth orbit or beyond (satellites, probes, landers, crewed spacecrafts, and space station components)

hover: <character> text used on the interactve map when hovering over a country. Displays country name and number of launch events for year selected using the sliding scale at the base of the map.

## Question 1: What nation is likely to dominate space in the not so distant future?

Question 1 - what country is most likely to become the first "space faring nation" and is there a close second? I propose to define "space faring nation" as the country that launches an order of magnitude more vehicles into space than all other countries combined. I'll fit a polynomial regression model to the dataset by country and extrapolate the model into the future to help identify the likely candidates.

## Approach

The question to be answered was to identify future space faring nations by identifying the counties with the most launch events in the future. To accomplish the tasks the original dataset, launch events by country as a function of year, was plotted on a ggplot geom_smooth() plot with year on the x-axis and the number of events on the y-axis, see Figure 1. To enable the user to interact with the dataset the data was also plotted on an interactive map, where a slider displayed launch data for a selected year, and by using a mouse to hover over a country launch data for that country could be displayed, see Figure 2. Both figures 1 and 2 provided insight into the evolution of the space launch industry and helped identify dominant countries. 
The tidytuesday space_launch_objects dataset was leveraged to create a second order polynomial model for the fifteen most dominant countries. The model was used to predict launch events by country for the fifteen selected countries for the period 2001 to 2100. That regression model was used to generate a new dataset “extrapolated_data” that stored the predicted launch event numbers by country. 
The “extrapolated_data” was then plotted on a smooth line plot, with years (2001 to 2100) on the x-axis, and the number of launch events on the y-axis, see Figure 3. The extrapolated_data was also plotted on an interactive map, see Figure 4. Using the map uses can select a year using a slider, see the number of total launch events on an evolving scale, and hover over one of the fifteen select countries to see specific launch data for a selected year. 


## Analysis 

The dataset “outer_space_objects” was loaded from the tidytuesday package and dplyr functions used to remove rows with missing data and, create the “hover” column to support the interactive map, and remove a categorical variable “world” from the “entity” column. Removing the “world” data reduced the dataset to include only country data for launched objects. The dataset provided the number of space vehicle launches by country between 1957 and 2023. The dataset was plotted on a static ggplot smooth line plot and an interactive map using ggplot2 and plotly respectively, see Figures 1 and 2. 

```{r echo = FALSE, warning = FALSE}
  
if (!require("pacman"))
  install.packages("pacman")

pacman::p_load(tidyverse, 
               dplyr, 
               ggplot2,
               readr,
               patchwork,
               gganimate,
               ggrepel,
               spData,
               plotly,
               rnaturalearth,
               RColorBrewer
              )


# cite: https://github.com/rfordatascience/tidytuesday/blob/master/data/2024/2024-04-23/readme.md

outer_space_objects <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2024/2024-04-23/outer_space_objects.csv')

view(outer_space_objects)

objects <- outer_space_objects |>
  na.omit() |>
  mutate(hover = paste0(Entity, "\n", num_objects)) |>
  filter(Entity != "World") 

```

Creating the first plot, the smooth line plot in ggplot2, required reducing the number of countries to 11 to support the scale_color_brewer palette limitations, see Figure 1. The dplyr package and the pipe function was used to isolate the eleven most active countries and then separate out that dataset from the original “outer_space_objects” dataset. A smooth line plot was used to display launches by country for the time period 1957 to 2023 for the eleven most active countries, see Figure 1. 

```{r echo = FALSE, warning = FALSE}
# cite: https://ggplot2.tidyverse.org/
# cite: Hadley Wickham, ggplot2, Elegant Graphics for Data Analysis 2nd Edition. Springer. 2016. 
# cite: https://r-graph-gallery.com/38-rcolorbrewers-palettes.html

top_11 <- objects |> # to keep things simple picked top 11 countries 
  group_by(Entity)|>
  summarize(total = sum(num_objects, na.rm = TRUE))|>
  arrange(desc(total)) |>
  top_n(total, n=11) |> #because scale_color_brewer has limits in number of entities
  select(Entity)

top_11_entity <- top_11$Entity # identify the 11 most active countries - simplify the plot

objects_top_11_countries <- objects |> # getting dataset for top 11 most active countries 
   filter(Entity %in% top_11_entity)

Figure_1 <- ggplot(data = objects_top_11_countries, aes(x=Year, y=num_objects, color = Entity)) +
  geom_smooth(se = FALSE, method = loess) +
  scale_color_brewer(palette = "Spectral") +
  theme(
    axis.text.x = element_text(size = 8, face = "bold"),
    axis.text.y = element_text(size = 8, face = "bold"),
    plot.title = element_text (size = 10, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 8, face = "plain", hjust = 0.5),
    plot.caption = element_text(size = 6, face = "plain", hjust = 1),
    panel.background = element_rect(fill = "white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_line(color = "gray95")
   ) +
  labs(
    x = "year of launch",
    y = "number of objects launched",
    title = "Figure 1: Number of objects launched into space by year (1957 to 2022)",
    subtitle = "data collected from United Nations Office of Outer Space Affairs",
    caption = "objects are defined as satelllites, probes, landers, crewed spacecrafts, and space station flights",
    colour = "Country"
  )

Figure_1 # ggplot smooth line plot of 1957 to 2022 launch data

```


To make things a little more interesting, enable some interaction with the data, the “outer_space_objects” dataset has been displayed on an interactive map, see Figure 2. Launch data for all countries in the “outer_space_objects” dataset is displayed on the map as a function of year and country, see Figure 2. Users can use the bar slider at the base of the map to see launch events per year by country. Hovering over a country displays the number of launch events in the year selected by the slider. The year selected on the sliding bar scale is displayed on the top right of the slider graphic. There is also a play function for the slider to the left. The interactive map was created using plotly after a lot of reading and watching an excellent YouTube video on the package, see citation. 

```{r echo = FALSE, warning = FALSE}
# cite: https://www.youtube.com/watch?v=RrtqBYLf404 (this is an excellent learning video)
# cite: https://plotly-r.com/maps
# cite: https://plotly.com/r/map-configuration/ (plotly learning)

Figure_2 <- plot_geo(objects,
                          locationmode = "world",
                          frame = ~Year) |>
  add_trace(locations = ~Code,
            z = ~num_objects,
            colorscale = 'Electric',
            text = ~hover,
            hoverinfo = 'text') |>
  layout(title = list(
      text = "<b>Figure 2: Number of Objects Launched into Space by country \n (1957 and 2023)",
      font = list(family = 'Arial', size = 16, color = 'black')   
      ),
           geo = list(
           scope = 'world',
           showland = TRUE,
           landcolor = toRGB("LightGreen"),
           showocean = TRUE,
           oceancolor = toRGB("LightBlue"),
           showcountries = TRUE,
           projection = list(type = "Mercator")),
         font = list(family = 'Arial', size = 12, color = 'black'),
         annotations = list(
           text = "<b>Data Source: tidytuesday,outer_space_objects.csv",
           showarrow = FALSE,
           x = 1,
           y = 0
         )) |>
   config(displayModeBar = FALSE)|>
   colorbar(title = "<b>Number of Objects", color = 'black') 

Figure_2 # interactve map of launched objects by country 1957 to 2023

```

The intent of the analysis was to determine what countries would dominate space launch events in the future. To answer the question a original “outer_space_objects” dataset was used to calculate a second order polynomial regression model for the fifteen most active countries. The model was used to predict the number of launch events as a function of year for each country. To accomplish this task a new dataset was created (new_data) with years 2001 to 2100 and the tibble() to hold the final data initialized (extrapolated_data). The fifteen most active countries were separated from the “outer_space_objects” dataset using dplyr pipe function (top_15_countries) and the country code added (country_plus_code) to enable the interactive map. Dplyr pipe functions significantly reduced the complexity of these tasks, prior to this class I would have used a lot of loops. A combination of a loop with embedded dplyr pipe functions was utilized to (a) select data for a country, (b) apply a polynomial model to that country data, (c) create the predicted launch data (y_pred) for the selected country, and (d) assemble all the data into one dataset “extrapolated_data" using the bind_rows function. Dplyr pipe functions were utilized again to create the final “extrapolated_data” dataset by renaming columns, setting negative y_pred value to zero, create the data for the hover column, and removing the non-country data i.e. “world”. 


```{r echo = FALSE, warning = FALSE}
# cite: https://www.youtube.com/watch?v=LRU5TxFD394&list=PLu6UwBFCnlEddsED6LFhgrg1vH-X6e4Ah (dplyr learning)


# The first plot provides data from 1957 to 2022
# to make things more interesting here attempt to extrapolate data out to 2100 
# next plot will provide data from 2001 to 2100 
# we'll see how this goes? 

# plan
# 1 - split the dataset by country - select top 15 countries as of 2022 (simplify the work/code?)
# 2 - use a polynomial to fit a model to the launch data for each country
# 3 - use the model to extrapolate out to 2100
# 4 - recombine the dataset into a single data frame 
# 5 - use Plotly to recreate the above using the extrapolated dataset 

data <-  objects # creating a new object 

new_data <- tibble( # creating the list of years to be used as x to predict number of launches
  Year = seq(2000, 2100, by = 1)
)

# unique(data$Entity)

extrapolated_data <- tibble() # initialize an object 

# view(data)
# view(new_data)

top_15_countries <- data |> # to keep things simple picked top 15 countries 
  group_by(Entity)|>
  summarize(total = sum(num_objects, na.rm = TRUE))|>
  arrange(desc(total)) |>
  top_n(total, n=16) |>
  select(Entity)

# unique(top_15_countries$Entity)

country_plus_code <- data |> # need country code to populate maps 
  distinct(Entity, Code) |>
  select(Entity, Code) |>
  semi_join(top_15_countries, by = "Entity")



# unique(country_plus_code$Entity)

# in the following for loop I extract data for a country
# them model (number of launches = function(year)) as a 2nd order polynomial
# I am using a 2nd order poly because the relationshis is not linear based on visual review of dataset
# Once the model is defined predicted data is calculated and stored in the temp_data variable
# dplyr mutate function is used to populate the temp_data variable with year, predicted launches, 
# and country name
# the loop calculates/predicts launches by country from 2000 to 2100
# the predicted data is stored in the tibble "extrapolated_data"
# bind_rows is used to add new calculations by country to the "extrapolated_data" variable

for (i in 1:nrow(top_15_countries)) {
  country = top_15_countries$Entity[i]
  selected_country <- data |> filter(Entity == country)
  model = lm(num_objects ~ poly(Year,2), data = selected_country)
  temp_data <- new_data |>
    mutate(
      y_pred = round(predict(model, newdata = new_data),0),
      Entity = country
      )
  extrapolated_data <- bind_rows(extrapolated_data,temp_data) 
  }

# unique(extrapolated_data$Entity)

#1 the "extrapolated_data variable populated in the loop does not contain country code
#2 I could not figure out how to add country codes within the loop - I tried for hours but so it goes
#3 Here the left_join function is used to add country code to the "extrapolated_data" variable
#4 The "extrapolated_data" variable has (i) year, (ii)y_pred, and (iii) Entity. 
#5 The "country_plus_code" has (iii) entity and (iv) code
#6 "y_pred" was rename "Predicted_Launches" to help with legend on map. y_pred originated from the modeling
#7 the model for Russia displayed negative launches at some point into the future so a mutate function was 
#7 used to prevent the map from displaying a negative number 

extrapolated_data <- extrapolated_data |>
  left_join(country_plus_code, by = "Entity") |>
  rename(predicted_launches = y_pred) |>
  mutate(predicted_launches = if_else(predicted_launches < 0, 0, predicted_launches)) |>
  mutate(hover = paste0(Entity, "\n", predicted_launches)) |>
  filter(Entity != "World")

# unique(extrapolated_data$Entity)

# summary(model)

```

The predicted launch data from 2001 to 2100 is displayed on a ggplot2, geom_smooth(), smooth line plot, see Figure 3. To display all fifteen countries the scale_color_brewer was removed from the code, that palette was limited to displaying eleven categorical variables. A review of available palettes did not identify an alternative capable of assigning high contract colors to fifteen variables within a category; as a result, the default was used. The colors displayed are not the best, the contrast is weak, but the only other option was to reduce the number of countries displayed from fifteen to eleven. 

```{r echo=FALSE,waring = FALSE}

Figure_3 <- ggplot(data = extrapolated_data, aes(x=Year, y=predicted_launches, color = Entity)) +
  geom_smooth(se = FALSE, method = loess) +
#  scale_color_brewer(palette = "Paired") + # limited to n < 11
  theme(
    axis.text.x = element_text(size = 8, face = "bold"),
    axis.text.y = element_text(size = 8, face = "bold"),
    plot.title = element_text (size = 10, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 8, face = "plain", hjust = 0.5),
    plot.caption = element_text(size = 6, face = "plain", hjust = 1),
    panel.background = element_rect(fill = "white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_line(color = "gray95")
   ) +
  labs(
    x = "year of launch",
    y = "number of objects launched",
    title = "Figure 3: Predicted number of objects launched into space by year (2000 to 2100)",
    subtitle = "(extrapolated from data collected from United Nations Office of Outer Space Affairs)",
    caption = "objects are defined as satelllites, probes, landers, crewed spacecrafts, and space station flights",
    color = "Country"
  )

Figure_3 # ggplot smooth line plot of predicted launch events 2001 to 2100 

```

An interactive map displaying predicted space launch events between 2001 and 2023, see Figure 4. The data displayed between 2001 and 2023 are predicted events based on the regression model, not actual launch events. The data 2024 to 2100 is the modeling extrapolating the data from 1957 to 2023 into the future. The map was created using Plotly and the “extrapolated_data” generated from the regression model. Within Plotly; plot_geo defines the type of plot – a world map in this instance. The add_trace functionality defines the variable tracked by the scale bar at the bottom of the plot. The layout definition describes the fonts, colors of land and oceans, the borders between countries, etc. 


```{r echo = FALSE, warning = FALSE}

Figure_4 <- plot_geo(extrapolated_data,
                          locationmode = "world",
                          frame = ~Year) |>
  add_trace(locations = ~Code,
            z = ~predicted_launches,
            zmin = 0,
            colorscale = 'Electric',
            text = ~hover,
            hoverinfo = 'text') |>
  layout(title = list(
      text = "<b>Figure 4: Predicted Number of Objects Launched into Space by Country \n (2001 and 2100)",
      font = list(family = 'Arial', size = 16, color = 'black')   
      ),
           geo = list(
           scope = 'world',
           showland = TRUE,
           landcolor = toRGB("LightGreen"),
           showocean = TRUE,
           oceancolor = toRGB("LightBlue"),
           showcountries = TRUE,
           projection = list(type = "Mercator")),
         font = list(family = 'Arial', size = 12, color = 'black'),
         annotations = list(
           text = "<b>Data Source: extrapolated polynomial model based on tidytuesday,outer_space_objects.csv",
           showarrow = FALSE,
           x = 1,
           y = 0
         )) |>
   config(displayModeBar = FALSE) |>
   colorbar(title = "<b>Number of Objects", color = 'black') 

Figure_4 # interactive map with predicted and extrapolated launch data from 2001 to 2100 

```

## Discussion 

An interactive map displaying predicted space launch events between 2001 and 2023. The data displayed between 2001 and 2023 is predicted events based on the regression model, not actual launch events. The data 2024 to 2100 is the modeling extrapolating the data from 1957 to 2023 into the future. On the map you can see the United States and Russia starting on an equal footing. As time progresses, the United States become more dominant, the demise of Russa is predicted, and the rise of both China and India is forecast. 



## Discussion
